{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Dev%20Directory/live/frontend/Blueprint_Front/src/modules/finance/budget/components/budgetWraper.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport {\r\n  fetchBudgetAccountsByProject,\r\n  createBudgetAccount,\r\n} from \"@/features/budget/budgetSlice\";\r\n\r\nimport { FundOverview } from \"@/modules/budget/fund/FundOverview\";\r\nimport BudgetRequestsPanel from \"@/modules/budget/request/BudgetRequestsPanel\";\r\nimport { TransactionHistory } from \"@/modules/budget/fund/TransactionHistory\";\r\nimport { AddFundDialog } from \"@/modules/budget/fund/AddFundDialog\";\r\nimport { CreateCategoryDialog } from \"@/modules/budget/category/CreateCategoryDialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Plus, Wallet, CheckCircle } from \"lucide-react\";\r\nimport  CategoryList  from \"@/modules/budget/category/CategoryList\";\r\n\r\nexport default function ProjectBudgetWrapper({ projectId, projectName }) {\r\n  const dispatch = useDispatch();\r\n  const { projectAccounts, loading, error } = useSelector(\r\n    (state) => state.budget\r\n  );\r\n  const BudgetAccount = projectAccounts?.[0] || null;\r\n\r\n  const ClientBudget = \"50cr\";\r\n  const [state, setState] = useState({\r\n    mainAccount: 0,\r\n    categories: [],\r\n    budgetRequests: [],\r\n    transactions: [],\r\n  });\r\n\r\n  // ----- Dialog States -----\r\n  const [addFundDialogOpen, setAddFundDialogOpen] = useState(false);\r\n  const [createCategoryDialogOpen, setCreateCategoryDialogOpen] =\r\n    useState(false);\r\n\r\n \r\n  // ----- Create Budget Account Dialog -----\r\n  const [openCreateAccountDialog, setOpenCreateAccountDialog] = useState(false);\r\n  const [initialBudget, setInitialBudget] = useState(\"\");\r\n  const [agreed, setAgreed] = useState(false);\r\n  const [success, setSuccess] = useState(false);\r\n  const [creating, setCreating] = useState(false);\r\n\r\n  // Fetch project accounts on mount\r\n  useEffect(() => {\r\n    if (projectId) dispatch(fetchBudgetAccountsByProject(projectId));\r\n  }, [dispatch, projectId]);\r\n\r\n  // ----- Totals -----\r\n  const totalAllocated = state.categories.reduce(\r\n    (sum, cat) => sum + cat.allocated,\r\n    0\r\n  );\r\n  const totalSpent = state.categories.reduce((sum, cat) => sum + cat.spent, 0);\r\n  const availableFunds = state.mainAccount - totalSpent;\r\n\r\n\r\n  const handleCreateBudgetAccount = async () => {\r\n    if (!initialBudget || !agreed) return;\r\n\r\n    const amount = parseFloat(initialBudget);\r\n    if (isNaN(amount) || amount <= 0) return;\r\n\r\n    setCreating(true);\r\n\r\n    try {\r\n      // Dispatch the thunk to create account\r\n      await dispatch(\r\n        createBudgetAccount({\r\n          projectId,\r\n          accountData: { initialAmount: amount },\r\n        })\r\n      ).unwrap();\r\n\r\n      setState((prev) => ({ ...prev, mainAccount: amount }));\r\n      setSuccess(true);\r\n\r\n      setTimeout(() => {\r\n        setSuccess(false);\r\n        setOpenCreateAccountDialog(false);\r\n        setInitialBudget(\"\");\r\n        setAgreed(false);\r\n      }, 1500);\r\n    } catch (err) {\r\n      alert(err.message || \"Failed to create account\");\r\n    } finally {\r\n      setCreating(false);\r\n    }\r\n  };\r\n\r\n  // ----- Loading or Empty State -----\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <p>Loading budget accounts...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!BudgetAccount || BudgetAccount.length === 0) {\r\n    return (\r\n      <div className=\"min-h-screen flex flex-col items-center justify-center space-y-6 p-4 text-center\">\r\n        <h1 className=\"text-2xl font-bold\">{projectName || \"Project\"}</h1>\r\n        <p className=\"text-muted-foreground\">\r\n          Client Budget INR: {ClientBudget || 0}\r\n        </p>\r\n\r\n        <Button onClick={() => setOpenCreateAccountDialog(true)}>\r\n          Create Budget Account\r\n        </Button>\r\n\r\n        {/* Create Budget Account Dialog */}\r\n        {openCreateAccountDialog && (\r\n          <div className=\"fixed inset-0 flex items-center justify-center bg-black/50 z-50\">\r\n            <div className=\"bg-white p-6 rounded-md w-96 space-y-4\">\r\n              <h2 className=\"text-xl font-bold\">\r\n                Create Project Budget Account\r\n              </h2>\r\n              <p>Enter the initial budget and agree to create a new account.</p>\r\n\r\n              {!success ? (\r\n                <>\r\n                  <Input\r\n                    type=\"number\"\r\n                    placeholder=\"Initial Budget Amount in INR\"\r\n                    value={initialBudget}\r\n                    onChange={(e) => setInitialBudget(e.target.value)}\r\n                  />\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Checkbox\r\n                      checked={agreed}\r\n                      onCheckedChange={(val) => setAgreed(!!val)}\r\n                    />\r\n                    <span>I agree to create this account</span>\r\n                  </div>\r\n                  <div className=\"flex justify-end gap-2\">\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      onClick={() => setOpenCreateAccountDialog(false)}\r\n                    >\r\n                      Cancel\r\n                    </Button>\r\n                    <Button\r\n                      onClick={handleCreateBudgetAccount}\r\n                      disabled={!agreed || !initialBudget || creating}\r\n                    >\r\n                      {creating ? \"Creating...\" : \"Create Account\"}\r\n                    </Button>\r\n                  </div>\r\n                </>\r\n              ) : (\r\n                <div className=\"flex flex-col items-center justify-center py-6\">\r\n                  <CheckCircle className=\"w-12 h-12 text-green-500 mb-2\" />\r\n                  <p className=\"text-green-600 font-medium\">\r\n                    Budget Account Created!\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // ----- Normal UI if accounts exist -----\r\n  return (\r\n    <div className=\"min-h-screen bg-background\">\r\n      <div className=\"mx-auto space-y-6\">\r\n     <div className=\"flex items-center justify-end gap-2\">\r\n  <Button onClick={() => setAddFundDialogOpen(true)}>\r\n    <Wallet className=\"h-4 w-4 mr-2\" />\r\n    Add Funds\r\n  </Button>\r\n  <Button\r\n    onClick={() => setCreateCategoryDialogOpen(true)}\r\n    // variant=\"outline\"\r\n  >\r\n    <Plus className=\"h-4 w-4 mr-2\" />\r\n    New Category\r\n  </Button>\r\n</div>\r\n\r\n\r\n        <FundOverview\r\n          BudgetAccount={BudgetAccount}\r\n          mainAccount={state.mainAccount}\r\n          totalAllocated={totalAllocated}\r\n          totalSpent={totalSpent}\r\n        />\r\n\r\n        <Tabs defaultValue=\"categories\" className=\"space-y-2\">\r\n          <TabsList>\r\n            <TabsTrigger value=\"requests\">Requests</TabsTrigger>\r\n            <TabsTrigger value=\"transactions\">Transactions</TabsTrigger>\r\n            <TabsTrigger value=\"categories\">Categories</TabsTrigger>\r\n          </TabsList>\r\n\r\n          <TabsContent value=\"categories\">\r\n            <CategoryList BudgetAccount={BudgetAccount} projectId={projectId} />\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"requests\">\r\n            <BudgetRequestsPanel projectId={projectId} />\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"transactions\">\r\n            <TransactionHistory\r\n              transactions={BudgetAccount?.transactions}\r\n              projectId={projectId}\r\n            />\r\n          </TabsContent>\r\n        </Tabs>\r\n      </div>\r\n\r\n      {/* Dialogs */}\r\n      <AddFundDialog\r\n        accountId={BudgetAccount?.accountId}\r\n        open={addFundDialogOpen}\r\n        onOpenChange={setAddFundDialogOpen}\r\n      />\r\n      <CreateCategoryDialog\r\n        BudgetAccount={BudgetAccount}\r\n        open={createCategoryDialogOpen}\r\n        onOpenChange={setCreateCategoryDialogOpen}\r\n        onCreateCategory={() => {}}\r\n        availableFunds={availableFunds}\r\n      />\r\n\r\n      \r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}